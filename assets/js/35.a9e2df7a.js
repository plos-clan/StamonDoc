(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{315:function(t,e,a){"use strict";a.r(e);var l=a(14),v=Object(l.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"字节码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字节码"}},[t._v("#")]),t._v(" 字节码")]),t._v(" "),e("p",[t._v("该文档详细讲述了"),e("code",[t._v("Stamon")]),t._v("字节码文件的组成, 以及各指令的功能")]),t._v(" "),e("blockquote",[e("p",[t._v("如果有能力, 您也可以依据此文档自行实现一个可以编译"),e("code",[t._v("Stamon")]),t._v("标准语法的编译器")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结构"}},[t._v("#")]),t._v(" 结构")]),t._v(" "),e("p",[t._v("一个标准的"),e("code",[t._v("Stamon")]),t._v("字节码文件应当符合以下结构")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("Index(字节)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ByteCodeFile")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("1 - 2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("0xADBD")]),t._v(" 文件魔数")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("3 - 4")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("Stamon字节码版本号")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("5 - 6")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("常量表总项数")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("(7+n)")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("常量表 - 详见"),e("a",{attrs:{href:"#%E5%B8%B8%E9%87%8F%E8%A1%A8"}},[t._v("常量表")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("(7+n) + a")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("指令区")])])])]),t._v(" "),e("h2",{attrs:{id:"常量表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常量表"}},[t._v("#")]),t._v(" 常量表")]),t._v(" "),e("p",[t._v("用于存储脚本运行过程中所需的所有值,标识符等. 作为部分字节码指令的操作数")]),t._v(" "),e("blockquote",[e("p",[t._v("为了增加"),e("code",[t._v("VM")]),t._v("索引速度, 规定表项第一位是存储了"),e("code",[t._v("标识符")]),t._v("类型的"),e("code",[t._v("__init__")]),t._v("值")])]),t._v(" "),e("p",[t._v("以下是一个常量表各种类型项的组成")]),t._v(" "),e("h4",{attrs:{id:"标准整形"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#标准整形"}},[t._v("#")]),t._v(" 标准整形")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("Index(字节)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("BinaryData")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("0x01")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n+2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("data")])])])])]),t._v(" "),e("h4",{attrs:{id:"双精浮点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#双精浮点"}},[t._v("#")]),t._v(" 双精浮点")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("Index(字节)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("BinaryData")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("0x02")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n+8")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("data")])])])])]),t._v(" "),e("h4",{attrs:{id:"字符串值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字符串值"}},[t._v("#")]),t._v(" 字符串值")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("Index(字节)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("BinaryData")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("0x03")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n+2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("Length")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n + Length")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("data")])])])])]),t._v(" "),e("h4",{attrs:{id:"标识符"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#标识符"}},[t._v("#")]),t._v(" 标识符")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("Index(字节)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("BinaryData")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("0x04")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n+2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("Length")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("n + Length")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("data")])])])])]),t._v(" "),e("h2",{attrs:{id:"字节码指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字节码指令"}},[t._v("#")]),t._v(" 字节码指令")]),t._v(" "),e("h4",{attrs:{id:"无参指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#无参指令"}},[t._v("#")]),t._v(" 无参指令")]),t._v(" "),e("p",[t._v("单字节指令,不包含任何操作数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("助记符")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("指令")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("ADD")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x01")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将操作栈栈顶两元素相加")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("SUB")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x02")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将操作栈栈顶两元素相减")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("CPL")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x03")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将栈顶元素按位取反")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("NOT")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x04")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将栈顶元素进行逻辑非运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("NEW")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x05")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("根据栈顶元素创建实例对象")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("MUL")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x06")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将栈顶两元素相乘")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("DIV")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x07")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将栈顶两元素相除")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("MOD")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x08")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素取余")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("LSH")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x09")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶元素位左移运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("RSH")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0A")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶元素位右移运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("LESS")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0B")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素小于关系比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("LEQ")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0C")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素小于等于比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("BIG")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0D")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素大于关系比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("BEQ")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0E")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素大于等于比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("EQU")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x0F")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素等于关系比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("IEQ")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x10")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素不等于比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("BAND")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x11")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素位与运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("BXOR")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x12")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素位异或运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("BOR")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x13")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素位或运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("LAND")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x14")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素逻辑与运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("LOR")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x15")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶两元素逻辑或运算")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("ASSIGN")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x16")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将栈顶元素赋值到栈下层元素")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("MEMBER")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x17")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("从栈顶元素提取成员")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("CALL")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x1E")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("执行方法")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("SFN")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x20")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("SFN")]),t._v("本地接口指令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("POS")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x21")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶元素取正")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("NEG")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x22")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("栈顶元素取负")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("RET")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x23")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("返回栈顶元素")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("ARRAY")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x24")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("加载数组")])])])]),t._v(" "),e("blockquote",[e("p",[t._v("保留指令 "),e("br"),t._v(" "),e("code",[t._v("BRK")]),t._v(" "),e("code",[t._v("0x25")]),t._v(" 终止循环 "),e("br"),t._v(" "),e("code",[t._v("CTN")]),t._v(" "),e("code",[t._v("0x26")]),t._v(" 退出此次循环")])]),t._v(" "),e("h4",{attrs:{id:"有参指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#有参指令"}},[t._v("#")]),t._v(" 有参指令")]),t._v(" "),e("p",[t._v("长度一般为2字节的指令,通常包含一个指令和操作数")]),t._v(" "),e("blockquote",[e("p",[e("code",[t._v("index")]),t._v(" 常量表索引 "),e("br"),t._v(" "),e("code",[t._v("pc")]),t._v(" 指令索引 "),e("br"),t._v(" "),e("code",[t._v("label")]),t._v(" 标记点")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("助记符")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("用法")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("指令")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("DEF")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("def")]),t._v(" "),e("code",[t._v("index")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x18")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("加载变量到变量表")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("GOTO")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("goto")]),t._v(" "),e("code",[t._v("pc/label")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x1c")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("无条件跳转到指定位置")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("PUSH")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("push")]),t._v(" "),e("code",[t._v("index")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x1d")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("将指定元素压入操作栈")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("IF")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("if")]),t._v(" "),e("code",[t._v("pc/label")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("0x1b")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("如果栈顶元素不是0或null,跳转至指定位置")])])])]),t._v(" "),e("h4",{attrs:{id:"结构指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结构指令"}},[t._v("#")]),t._v(" 结构指令")]),t._v(" "),e("p",[t._v("通常具有一定的作用域")]),t._v(" "),e("h5",{attrs:{id:"class"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#class"}},[t._v("#")]),t._v(" CLASS")]),t._v(" "),e("p",[t._v("将作用域内指令全部加载为类内成员,并将构建好的类直接压入操作栈")]),t._v(" "),e("ul",[e("li",[t._v("指令 "),e("code",[t._v("0x1F")])])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("class\n<bytecode>\n<bytecode>\n...\nend\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h5",{attrs:{id:"func"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#func"}},[t._v("#")]),t._v(" FUNC")]),t._v(" "),e("p",[t._v("将作用域内指令全部加载为方法集合,并将构建好的方法直接压入操作栈")]),t._v(" "),e("ul",[e("li",[t._v("指令 "),e("code",[t._v("0x1B")])])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func\n<bytecode>\n<bytecode>\n...\nend\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h5",{attrs:{id:"end"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#end"}},[t._v("#")]),t._v(" END")]),t._v(" "),e("p",[t._v("用于结束一个作用域")]),t._v(" "),e("ul",[e("li",[t._v("指令 "),e("code",[t._v("0x1a")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);